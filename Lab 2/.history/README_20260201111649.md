# HÆ¯á»šNG DáºªN BÃ€I Táº¬P TCP/UDP

## ğŸ“‹ Má»¤C Lá»¤C
1. [BÃ i 1: Giáº£i phÆ°Æ¡ng trÃ¬nh báº­c 2](#bÃ i-1-giáº£i-phÆ°Æ¡ng-trÃ¬nh-báº­c-2)
2. [BÃ i 2: NhÃ¢n hai ma tráº­n](#bÃ i-2-nhÃ¢n-hai-ma-tráº­n)
3. [BÃ i 3: Thay tháº¿ chuá»—i trong file](#bÃ i-3-thay-tháº¿-chuá»—i-trong-file)
4. [BÃ i 4: Xá»­ lÃ½ chuá»—i](#bÃ i-4-xá»­-lÃ½-chuá»—i)
5. [BÃ i 5: Chat room](#bÃ i-5-chat-room)
6. [So sÃ¡nh TCP vs UDP](#so-sÃ¡nh-tcp-vs-udp)

---

## BÃ i 1: Giáº£i phÆ°Æ¡ng trÃ¬nh báº­c 2

### ğŸ“ MÃ´ táº£
Client gá»­i 3 sá»‘ `a, b, c` Ä‘áº¿n server. Server giáº£i phÆ°Æ¡ng trÃ¬nh `axÂ² + bx + c = 0` vÃ  gá»­i káº¿t quáº£ vá» client.

### ğŸš€ CÃ¡ch cháº¡y

**TCP:**
```bash
# Terminal 1
node 1_tcp_server.js

# Terminal 2
node 1_tcp_client.js
```

**UDP:**
```bash
# Terminal 1
node 1_udp_server.js

# Terminal 2
node 1_udp_client.js
```

### ğŸ’¡ VÃ­ dá»¥
```
Nháº­p a b c: 1 -5 6
â†’ x1 = 3.00, x2 = 2.00

Nháº­p a b c: 1 -4 4
â†’ Nghiá»‡m kÃ©p: x = 2.00

Nháº­p a b c: 1 2 5
â†’ VÃ´ nghiá»‡m
```

### ğŸ” Giáº£i thÃ­ch code

**Server (TCP):**
```javascript
const net = require('net');  // Module TCP

// HÃ m giáº£i phÆ°Æ¡ng trÃ¬nh
function solve(a, b, c) {
    const delta = b*b - 4*a*c;  // TÃ­nh delta
    
    if (delta < 0) return 'VÃ´ nghiá»‡m';
    
    if (delta === 0) {
        const x = -b / (2*a);  // Nghiá»‡m kÃ©p
        return `Nghiá»‡m kÃ©p: x = ${x.toFixed(2)}`;
    }
    
    // 2 nghiá»‡m phÃ¢n biá»‡t
    const x1 = (-b + Math.sqrt(delta)) / (2*a);
    const x2 = (-b - Math.sqrt(delta)) / (2*a);
    return `x1 = ${x1.toFixed(2)}, x2 = ${x2.toFixed(2)}`;
}

// Táº¡o server
const server = net.createServer((socket) => {
    socket.on('data', (data) => {
        const input = data.toString();
        const [a, b, c] = input.split(' ').map(Number);
        
        const result = solve(a, b, c);
        socket.write(result);  // Gá»­i káº¿t quáº£
    });
});

server.listen(5000);  // Láº¯ng nghe cá»•ng 5000
```

**Client (TCP):**
```javascript
const client = new net.Socket();

client.connect(5000, '127.0.0.1', () => {
    // Káº¿t ná»‘i thÃ nh cÃ´ng
    askInput();
});

function askInput() {
    rl.question('Nháº­p a b c: ', (input) => {
        client.write(input);  // Gá»­i Ä‘áº¿n server
    });
}

client.on('data', (data) => {
    console.log(`â†’ ${data}`);  // Nháº­n káº¿t quáº£
});
```

**Sá»± khÃ¡c biá»‡t UDP:**
```javascript
// UDP Server
const server = dgram.createSocket('udp4');
server.on('message', (msg, rinfo) => {
    // Xá»­ lÃ½...
    server.send(result, rinfo.port, rinfo.address);
});

// UDP Client
const client = dgram.createSocket('udp4');
client.send(msg, PORT, HOST);
```

---

## BÃ i 2: NhÃ¢n hai ma tráº­n

### ğŸ“ MÃ´ táº£
Client gá»­i 2 ma tráº­n Ä‘áº¿n server. Server tÃ­nh tÃ­ch 2 ma tráº­n vÃ  gá»­i káº¿t quáº£ vá».

### ğŸš€ CÃ¡ch cháº¡y
```bash
node 2_tcp_server.js  # hoáº·c 2_udp_server.js
node 2_tcp_client.js  # hoáº·c 2_udp_client.js
```

### ğŸ’¡ VÃ­ dá»¥
```
A (r c): 2 2
Nháº­p 4 sá»‘: 1 2 3 4

B (r c): 2 2
Nháº­p 4 sá»‘: 5 6 7 8

AÃ—B:
  19  22
  43  50
```

### ğŸ” Giáº£i thÃ­ch thuáº­t toÃ¡n nhÃ¢n ma tráº­n

**CÃ´ng thá»©c:** `C[i][j] = Î£(A[i][k] Ã— B[k][j])`

```javascript
function multiply(A, B) {
    const m = A.length;        // Sá»‘ hÃ ng A
    const n = B.length;        // Sá»‘ cá»™t A = sá»‘ hÃ ng B
    const p = B[0].length;     // Sá»‘ cá»™t B
    
    const C = [];
    for (let i = 0; i < m; i++) {
        C[i] = [];
        for (let j = 0; j < p; j++) {
            C[i][j] = 0;
            // TÃ­nh tá»•ng tÃ­ch
            for (let k = 0; k < n; k++) {
                C[i][j] += A[i][k] * B[k][j];
            }
        }
    }
    return C;
}
```

**VÃ­ dá»¥ cá»¥ thá»ƒ:**
```
A = [1 2]    B = [5 6]
    [3 4]        [7 8]

C[0][0] = 1Ã—5 + 2Ã—7 = 5 + 14 = 19
C[0][1] = 1Ã—6 + 2Ã—8 = 6 + 16 = 22
C[1][0] = 3Ã—5 + 4Ã—7 = 15 + 28 = 43
C[1][1] = 3Ã—6 + 4Ã—8 = 18 + 32 = 50

Káº¿t quáº£: [19 22]
         [43 50]
```

### ğŸ” CÃ¡ch gá»­i ma tráº­n qua máº¡ng

**Sá»­ dá»¥ng JSON:**
```javascript
// Client gá»­i
const data = JSON.stringify({
    m1: [[1,2],[3,4]],
    m2: [[5,6],[7,8]]
});
socket.write(data);

// Server nháº­n
const { m1, m2 } = JSON.parse(data.toString());
```

---

## BÃ i 3: Thay tháº¿ chuá»—i trong file

### ğŸ“ MÃ´ táº£
Client gá»­i:
- Ná»™i dung file text
- Chuá»—i cáº§n tÃ¬m (s1)
- Chuá»—i thay tháº¿ (s2)

Server thay tháº¿ táº¥t cáº£ `s1` báº±ng `s2` vÃ  gá»­i file káº¿t quáº£ vá».

### ğŸš€ CÃ¡ch cháº¡y
```bash
node 3_tcp_server.js  # hoáº·c 3_udp_server.js
node 3_tcp_client.js  # hoáº·c 3_udp_client.js
```

### ğŸ’¡ VÃ­ dá»¥

**File test.txt:**
```
Hello world
This is a test file
Hello everyone
```

**Thá»±c hiá»‡n:**
```
ÄÆ°á»ng dáº«n file: test.txt
Chuá»—i cáº§n thay tháº¿ (s1): Hello
Chuá»—i thay tháº¿ (s2): Hi
LÆ°u káº¿t quáº£ vÃ o file: result.txt
âœ“ ÄÃ£ thay tháº¿ 2 láº§n
```

**File result.txt:**
```
Hi world
This is a test file
Hi everyone
```

### ğŸ” Giáº£i thÃ­ch code

**Äá»c file:**
```javascript
const fs = require('fs');

// Äá»c file Ä‘á»“ng bá»™
const content = fs.readFileSync('test.txt', 'utf8');
```

**Thay tháº¿ chuá»—i:**
```javascript
function replaceAll(content, s1, s2) {
    // CÃ¡ch 1: DÃ¹ng split vÃ  join
    return content.split(s1).join(s2);
    
    // CÃ¡ch 2: DÃ¹ng replaceAll (ES2021)
    // return content.replaceAll(s1, s2);
}
```

**Äáº¿m sá»‘ láº§n xuáº¥t hiá»‡n:**
```javascript
const count = content.split(s1).length - 1;
```

**Ghi file:**
```javascript
fs.writeFileSync('result.txt', newContent, 'utf8');
```

---

## BÃ i 4: Xá»­ lÃ½ chuá»—i

### ğŸ“ MÃ´ táº£
Server cung cáº¥p cÃ¡c lá»‡nh xá»­ lÃ½ chuá»—i:
- `UPPER`: Chuyá»ƒn chá»¯ thÆ°á»ng â†’ HOA
- `LOWER`: Chuyá»ƒn chá»¯ HOA â†’ thÆ°á»ng
- `DELETE`: XÃ³a má»™t pháº§n chuá»—i
- `INSERT`: ChÃ¨n chuá»—i con

### ğŸš€ CÃ¡ch cháº¡y
```bash
node 4_tcp_server.js  # hoáº·c 4_udp_server.js
node 4_tcp_client.js  # hoáº·c 4_udp_client.js
```

### ğŸ’¡ VÃ­ dá»¥ cÃ¡c lá»‡nh

```bash
# Chuyá»ƒn HOA
Nháº­p lá»‡nh: UPPER|hello world
â†’ HELLO WORLD

# Chuyá»ƒn thÆ°á»ng
Nháº­p lá»‡nh: LOWER|HELLO WORLD
â†’ hello world

# XÃ³a kÃ½ tá»± tá»« vá»‹ trÃ­ 0 Ä‘áº¿n 5
Nháº­p lá»‡nh: DELETE|hello world|0|5
â†’  world

# ChÃ¨n " beautiful" vÃ o vá»‹ trÃ­ 5
Nháº­p lá»‡nh: INSERT|hello world|5| beautiful
â†’ hello beautiful world
```

### ğŸ” Giáº£i thÃ­ch code

**Protocol thiáº¿t káº¿:**
```
Format: COMMAND|text|param1|param2
PhÃ¢n tÃ¡ch báº±ng dáº¥u |
```

**Server xá»­ lÃ½:**
```javascript
function processCommand(cmd, text, ...params) {
    switch(cmd) {
        case 'UPPER':
            return text.toUpperCase();
        
        case 'LOWER':
            return text.toLowerCase();
        
        case 'DELETE':
            const [start, end] = params.map(Number);
            // Cáº¯t tá»« 0->start, ná»‘i vá»›i end->cuá»‘i
            return text.slice(0, start) + text.slice(end);
        
        case 'INSERT':
            const pos = Number(params[0]);
            const substr = params[1];
            // Cáº¯t 0->pos, chÃ¨n substr, ná»‘i pos->cuá»‘i
            return text.slice(0, pos) + substr + text.slice(pos);
        
        default:
            return 'Lá»‡nh khÃ´ng há»£p lá»‡';
    }
}
```

**Client gá»­i:**
```javascript
// Parse input
const parts = data.toString().split('|');
const [cmd, text, ...params] = parts;

// Xá»­ lÃ½
const result = processCommand(cmd, text, ...params);
```

---

## BÃ i 5: Chat room

### ğŸ“ MÃ´ táº£
Táº¡o phÃ²ng chat cho phÃ©p nhiá»u mÃ¡y tÃ­nh trao Ä‘á»•i thÃ´ng tin. Má»—i tin nháº¯n Ä‘Æ°á»£c broadcast Ä‘áº¿n táº¥t cáº£ client khÃ¡c.

### ğŸš€ CÃ¡ch cháº¡y

```bash
# Terminal 1: Server
node 5_tcp_server.js  # hoáº·c 5_udp_server.js

# Terminal 2, 3, 4...: Nhiá»u client
node 5_tcp_client.js  # hoáº·c 5_udp_client.js
```

### ğŸ’¡ VÃ­ dá»¥

**Terminal 1 (Alice):**
```
Nháº­p tÃªn: Alice
[SERVER] Alice Ä‘Ã£ tham gia chat!
> Hello everyone!
âœ“ ÄÃ£ gá»­i
[Bob]: Hi Alice!
```

**Terminal 2 (Bob):**
```
Nháº­p tÃªn: Bob
[Alice]: Hello everyone!
> Hi Alice!
âœ“ ÄÃ£ gá»­i
```

### ğŸ” Giáº£i thÃ­ch code

**Server quáº£n lÃ½ danh sÃ¡ch client:**
```javascript
const clients = [];  // Máº£ng lÆ°u táº¥t cáº£ socket

server.on('connection', (socket) => {
    // ThÃªm client má»›i
    clients.push({ socket, username });
    
    socket.on('data', (data) => {
        const message = data.toString();
        
        // Broadcast cho táº¥t cáº£ (trá»« ngÆ°á»i gá»­i)
        broadcast(message, socket);
    });
    
    socket.on('close', () => {
        // XÃ³a client khi disconnect
        const index = clients.indexOf(socket);
        clients.splice(index, 1);
    });
});
```

**HÃ m broadcast:**
```javascript
function broadcast(message, exclude = null) {
    clients.forEach(client => {
        // KhÃ´ng gá»­i láº¡i cho ngÆ°á»i gá»­i
        if (client.socket !== exclude) {
            client.socket.write(message + '\n');
        }
    });
}
```

**UDP Chat (khÃ¡c biá»‡t):**
```javascript
// UDP khÃ´ng cÃ³ "connection", pháº£i track clients thá»§ cÃ´ng
const clients = new Map();  // Map<"ip:port", username>

server.on('message', (msg, rinfo) => {
    const key = `${rinfo.address}:${rinfo.port}`;
    
    // LÆ°u thÃ´ng tin client
    clients.set(key, username);
    
    // Broadcast
    clients.forEach((username, clientKey) => {
        const [addr, port] = clientKey.split(':');
        server.send(msg, parseInt(port), addr);
    });
});
```

---

## So sÃ¡nh TCP vs UDP

### ğŸ“Š Báº£ng so sÃ¡nh

| TiÃªu chÃ­ | TCP | UDP |
|----------|-----|-----|
| **Káº¿t ná»‘i** | CÃ³ (3-way handshake) | KhÃ´ng |
| **Äá»™ tin cáº­y** | Äáº£m báº£o gá»­i Ä‘áº¿n | KhÃ´ng Ä‘áº£m báº£o |
| **Thá»© tá»±** | ÄÃºng thá»© tá»± | CÃ³ thá»ƒ sai thá»© tá»± |
| **Tá»‘c Ä‘á»™** | Cháº­m hÆ¡n | Nhanh hÆ¡n |
| **Overhead** | Lá»›n | Nhá» |
| **Module Node.js** | `net` | `dgram` |
| **Táº¡o server** | `net.createServer()` | `dgram.createSocket('udp4')` |
| **Gá»­i dá»¯ liá»‡u** | `socket.write()` | `socket.send(msg, port, host)` |
| **Nháº­n dá»¯ liá»‡u** | `socket.on('data')` | `socket.on('message')` |
| **Use case** | File transfer, Chat | Streaming, Gaming |

### ğŸ’» Code so sÃ¡nh

**TCP:**
```javascript
// Server
const net = require('net');
const server = net.createServer((socket) => {
    socket.on('data', (data) => {
        socket.write('Response');
    });
});
server.listen(5000);

// Client
const client = new net.Socket();
client.connect(5000, '127.0.0.1');
client.write('Hello');
```

**UDP:**
```javascript
// Server
const dgram = require('dgram');
const server = dgram.createSocket('udp4');
server.on('message', (msg, rinfo) => {
    server.send('Response', rinfo.port, rinfo.address);
});
server.bind(5000);

// Client
const client = dgram.createSocket('udp4');
const msg = Buffer.from('Hello');
client.send(msg, 5000, '127.0.0.1');
```

---

## ğŸ¯ Khi nÃ o dÃ¹ng TCP vs UDP?

### DÃ¹ng TCP khi:
- âœ… Cáº§n Ä‘áº£m báº£o dá»¯ liá»‡u Ä‘áº¿n Ä‘Ã­ch
- âœ… Thá»© tá»± tin nháº¯n quan trá»ng
- âœ… VÃ­ dá»¥: Chat, file transfer, email

### DÃ¹ng UDP khi:
- âœ… Tá»‘c Ä‘á»™ quan trá»ng hÆ¡n Ä‘á»™ tin cáº­y
- âœ… Cháº¥p nháº­n máº¥t má»™t Ã­t dá»¯ liá»‡u
- âœ… VÃ­ dá»¥: Video streaming, game online, DNS

---

## ğŸ”§ Troubleshooting

### Lá»—i thÆ°á»ng gáº·p:

**1. `EADDRINUSE` - Port Ä‘Ã£ Ä‘Æ°á»£c sá»­ dá»¥ng**
```bash
# TÃ¬m process Ä‘ang dÃ¹ng port
netstat -ano | findstr :5000

# Kill process (Windows)
taskkill /PID <PID> /F
```

**2. `ECONNREFUSED` - KhÃ´ng káº¿t ná»‘i Ä‘Æ°á»£c**
- Kiá»ƒm tra server Ä‘Ã£ cháº¡y chÆ°a
- Kiá»ƒm tra port vÃ  IP Ä‘Ãºng khÃ´ng
- Kiá»ƒm tra firewall

**3. Client khÃ´ng nháº­n Ä‘Æ°á»£c dá»¯ liá»‡u**
- TCP: Kiá»ƒm tra `socket.write()` vÃ  `socket.on('data')`
- UDP: Kiá»ƒm tra `socket.send()` vÃ  `socket.on('message')`

---

## ğŸ“š TÃ i liá»‡u tham kháº£o

- [Node.js Net Documentation](https://nodejs.org/api/net.html)
- [Node.js Dgram Documentation](https://nodejs.org/api/dgram.html)
- [TCP/IP Protocol](https://en.wikipedia.org/wiki/Transmission_Control_Protocol)
- [UDP Protocol](https://en.wikipedia.org/wiki/User_Datagram_Protocol)

---

## âœ… Checklist há»c táº­p

- [ ] Hiá»ƒu khÃ¡c biá»‡t TCP vs UDP
- [ ] Biáº¿t cÃ¡ch táº¡o server/client vá»›i `net` vÃ  `dgram`
- [ ] Biáº¿t cÃ¡ch gá»­i/nháº­n dá»¯ liá»‡u
- [ ] Biáº¿t serialize/deserialize data (JSON)
- [ ] Hiá»ƒu event-driven programming
- [ ] Biáº¿t xá»­ lÃ½ nhiá»u client (broadcast)
- [ ] Biáº¿t xá»­ lÃ½ lá»—i vÃ  disconnect

---

**ğŸ‰ ChÃºc báº¡n há»c tá»‘t!**
